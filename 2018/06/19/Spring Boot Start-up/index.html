<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Spring Boot 启动速度优化 | 张克升的个人博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Spring Boot 启动速度优化</h1><a id="logo" href="/.">张克升的个人博客</a><p class="description">不想当架构师的工程师不是好的程序员</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Spring Boot 启动速度优化</h1><div class="post-meta"><a href="/2018/06/19/Spring Boot Start-up/#comments" class="comment-count"></a><p><span class="date">Jun 19, 2018</span><span><a href="/categories/笔记/" class="category">笔记</a></span></p></div><div class="post-content"><h1 id="Spring-Boot-启动速度优化"><a href="#Spring-Boot-启动速度优化" class="headerlink" title="Spring Boot 启动速度优化"></a>Spring Boot 启动速度优化</h1><p>开始优化…</p>
<p>现用版本: java8; spring boot 1.5, gradle3.3; 监控工具: jProfiler9.2.1</p>
<blockquote>
<p>参考文章: </p>
<p><a href="https://alexecollins.com/spring-boot-performance/" target="_blank" rel="external">Spring Boot Performance –Alex Collins</a></p>
<p><a href="http://www.baeldung.com/spring-boot-application-configuration" target="_blank" rel="external">Configure a Spring Boot Web Application</a></p>
</blockquote>
<h2 id="组件自动扫描问题"><a href="#组件自动扫描问题" class="headerlink" title="组件自动扫描问题"></a>组件自动扫描问题</h2><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>默认情况下, 我们会使用<code>@SpringBootApplication</code>注解来自动获取应用的配置信息. 这样会有一些副作用. 其中一个就是组件扫描<code>@ComponentScan</code> . 它会拖慢应用启动的速度, 也会加载一些不必要的bean. </p>
<h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>所以第一步就是干掉这两个注解, 使用<code>EnableAutoConfiguration</code> 来代替. 然后需要手动<code>Import</code>需要的class.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnableAutoConfiguration</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@Import</span>(value = &#123;</div><div class="line">  DefaultConfiguration.class,</div><div class="line">  BeforeControllerAdvice.class,</div><div class="line">  DefaultSearchServiceImpl.class,</div><div class="line">  SearchController.class,</div><div class="line">&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    SpringApplication.run(DemoApplication.class, args);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果不知道需要引入哪些类, 可以通过在启动命令中加入<code>-Ddebug</code>来打印出那些类是自动加载的. </p>
<blockquote>
<p><a href="(https://alexecollins.com/spring-boot-performance/">Spring Boot Performance</a>)中提到的<code>DispatcherServletAutoConfiguration</code>等class, 不需要引入, 在项目启动时也会自动加载, 只需要<code>Import</code>自己写的类即可. </p>
</blockquote>
<h2 id="修改Servlet"><a href="#修改Servlet" class="headerlink" title="修改Servlet"></a>修改Servlet</h2><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>默认情况下, Spring Boot使用Tomcat. Tomcat使用大约110MB的堆, 并且具有~16个线程.</p>
<h3 id="Undertow"><a href="#Undertow" class="headerlink" title="Undertow"></a>Undertow</h3><p>Undertow是一个用java编写的灵活的高性能Web服务器, 提供基于NIO的阻塞和非阻塞API.</p>
<p>相比于tomcat, undertow会占用更少的内存.</p>
<h3 id="如何将servlet改为undertow"><a href="#如何将servlet改为undertow" class="headerlink" title="如何将servlet改为undertow"></a>如何将servlet改为undertow</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">compile(<span class="string">"org.springframework.boot:spring-boot-starter-web:$&#123;springBootVersion&#125;"</span>)</div><div class="line">    &#123;</div><div class="line">      exclude group: <span class="string">"org.springframework.boot"</span>, <span class="keyword">module</span>: <span class="string">"spring-boot-starter-tomcat"</span></div><div class="line">    &#125;</div><div class="line">  compile group: <span class="string">"org.springframework.boot"</span>, name: <span class="string">"spring-boot-starter-undertow"</span>, version: <span class="string">"$&#123;springBootVersion&#125;"</span></div></pre></td></tr></table></figure>
<p>若使用了<code>spring-boot-starter-tomcat</code>的其他工具类, 请自行引用相应工具类.</p>
<h2 id="Xmx"><a href="#Xmx" class="headerlink" title="-Xmx"></a>-Xmx</h2><p><code>-Xmx</code>参数是限制JVM的最大Heap, 若没有设置JVM会尽量多的吃更多的内存, 根据项目的实际需求设置<code>Xmx</code>可以避免java项目吃掉太多内存</p>
<h2 id="java10"><a href="#java10" class="headerlink" title="java10"></a>java10</h2><p>最后, 也是最重要的一点, java10对java项目的启动做了优化, 将jdk版本升级到10以后, java的启动速度明显加快.</p>
<p>在java10, sping boot 2.0的环境下, 相比于java8, 快了20%以上(仅以一个项目做过测试, 数据仅供参考)</p>
<p><strong>由于升级所带来的一些困扰, 不同的项目自行解决…</strong></p>
</div><div class="tags"><a href="/tags/spring-boot/">spring boot</a><a href="/tags/java/">java</a></div><div class="post-share"></div><div class="post-nav"><a href="/2018/06/25/kubernetes-istio-v2/" class="pre">kubernetes-istio-v2</a><a href="/2018/06/11/phpMyAdmin/" class="next">phpMyAdmin</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Boot-启动速度优化"><span class="toc-text">Spring Boot 启动速度优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#组件自动扫描问题"><span class="toc-text">组件自动扫描问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBootApplication"><span class="toc-text">@SpringBootApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EnableAutoConfiguration"><span class="toc-text">@EnableAutoConfiguration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改Servlet"><span class="toc-text">修改Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat"><span class="toc-text">Tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Undertow"><span class="toc-text">Undertow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何将servlet改为undertow"><span class="toc-text">如何将servlet改为undertow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xmx"><span class="toc-text">-Xmx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java10"><span class="toc-text">java10</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/06/29/zookeeper-conformance-principle/">zookeeper-conformance-principle</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/25/kubernetes-istio-v2/">kubernetes-istio-v2</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/19/Spring Boot Start-up/">Spring Boot 启动速度优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/11/phpMyAdmin/">phpMyAdmin</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/16/Let’s Encrypt SSL/">Let's Encrypt 实现站点 SSL</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/12/kubernetes-istio/">kubernetes-istio</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/30/Best Practices for Maintainers/">维护者的最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/kubenetes-docker/">Kubernetes安装脚本(docker-compose)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/kubernetes-ha/">部署高可用的k8s集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/Kubernetes-Install/">Kubernetes Install</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/translate/">translate</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/笔记/">笔记</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/spring-boot/" style="font-size: 15px;">spring boot</a> <a href="/tags/笔记/" style="font-size: 15px;">笔记</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/无题/" style="font-size: 15px;">无题</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/istio/" style="font-size: 15px;">istio</a> <a href="/tags/SSL/" style="font-size: 15px;">SSL</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">张克升.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script></body></html>